# Test: Store State
# Category: State Management
# Purpose: Tests storing and retrieving state values

name: "Store State Test"
description: |
  Tests the state storage functionality.
  Demonstrates how to store command results and retrieve them later.

backend: mineflayer

setup:
  - action: "connect"
    player: "pilaf_state"
    name: "Connect state test player"

  - action: "wait"
    duration: 5
    name: "Wait for connection"

  - action: "servercommand"
    command: "say [Pilaf] Starting store state test..."
    name: "Announce test start"

steps:
  # Test 1: Store player position
  - action: "get_player_position"
    player: "pilaf_state"
    name: "Get player position"
    storeAs: "position_1"

  # Test 2: Print stored state
  - action: "print_stored_state"
    variableName: "position_1"
    name: "Print stored position"

  # Test 3: Store player health
  - action: "get_player_health"
    player: "pilaf_state"
    name: "Get player health"
    storeAs: "health_1"

  - action: "print_stored_state"
    variableName: "health_1"
    name: "Print stored health"

  # Test 4: Teleport to new location
  - action: "servercommand"
    command: "tp pilaf_state 200 64 200"
    name: "Teleport player"

  - action: "wait"
    duration: 3
    name: "Wait for teleport"

  # Test 5: Store new position
  - action: "get_player_position"
    player: "pilaf_state"
    name: "Get new player position"
    storeAs: "position_2"

  - action: "print_stored_state"
    variableName: "position_2"
    name: "Print new position"

  # Test 6: Store inventory
  - action: "getinventory"
    player: "pilaf_state"
    name: "Get player inventory"
    storeAs: "inventory_1"

  - action: "print_stored_state"
    variableName: "inventory_1"
    name: "Print stored inventory"

  # Test 7: Store weather status
  - action: "get_weather"
    name: "Get weather status"
    storeAs: "weather_1"

  - action: "print_stored_state"
    variableName: "weather_1"
    name: "Print stored weather"

  # Test 8: Store world time
  - action: "get_world_time"
    name: "Get world time"
    storeAs: "time_1"

  - action: "print_stored_state"
    variableName: "time_1"
    name: "Print stored time"

  # Test 9: Store entities
  - action: "getentities"
    player: "pilaf_state"
    name: "Get nearby entities"
    storeAs: "entities_1"

  - action: "print_stored_state"
    variableName: "entities_1"
    name: "Print stored entities"

cleanup:
  - action: "servercommand"
    command: "tp pilaf_state 0 64 0"
    name: "Return player to spawn"

  - action: "servercommand"
    command: "say [Pilaf] Store state test completed"
    name: "Announce completion"

  - action: "disconnect"
    player: "pilaf_state"
    name: "Disconnect test player"
