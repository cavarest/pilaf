# Test: Player Connection
# Category: Player Commands
# Purpose: Tests player connection and disconnection operations

name: "Player Connection Test"
description: |
  Tests player connection and disconnection operations.
  Validates that players can connect to the server and
  disconnect cleanly.

backend: mineflayer

setup:
  - action: "servercommand"
    command: "say [Pilaf] Starting player connection test..."
    name: "Announce test start"

steps:
  # Test 1: Connect first player
  - action: "connect"
    player: "pilaf_tester_1"
    name: "Connect first test player"

  - action: "wait"
    duration: 5
    name: "Wait for first player connection"

  - action: "get_player_health"
    player: "pilaf_tester_1"
    name: "Check first player health"
    storeAs: "health_player_1"

  # Test 2: Connect second player
  - action: "connect"
    player: "pilaf_tester_2"
    name: "Connect second test player"

  - action: "wait"
    duration: 5
    name: "Wait for second player connection"

  - action: "get_player_health"
    player: "pilaf_tester_2"
    name: "Check second player health"
    storeAs: "health_player_2"

  # Test 3: Verify both players are online
  - action: "servercommand"
    command: "list"
    name: "List online players"

  # Test 4: Disconnect first player
  - action: "disconnect"
    player: "pilaf_tester_1"
    name: "Disconnect first player"

  - action: "wait"
    duration: 2
    name: "Wait for disconnection"

  # Test 5: Verify second player still connected
  - action: "servercommand"
    command: "list"
    name: "List players after disconnection"

  # Test 6: Reconnect first player
  - action: "connect"
    player: "pilaf_tester_1"
    name: "Reconnect first test player"

  - action: "wait"
    duration: 5
    name: "Wait for reconnection"

  # Test 7: Final player list check
  - action: "servercommand"
    command: "list"
    name: "Final player list check"

cleanup:
  - action: "disconnect"
    player: "pilaf_tester_1"
    name: "Disconnect first player"

  - action: "disconnect"
    player: "pilaf_tester_2"
    name: "Disconnect second player"

  - action: "servercommand"
    command: "say [Pilaf] Player connection test completed"
    name: "Announce completion"
