# Test: Entity Filtering
# Category: State Management
# Purpose: Tests entity filtering and retrieval

name: "Entity Filtering Test"
description: |
  Tests entity filtering by various criteria.
  Demonstrates getting entities and filtering by type.

backend: mineflayer

setup:
  - action: "connect"
    player: "pilaf_filter"
    name: "Connect entity filter test player"

  - action: "wait"
    duration: 5
    name: "Wait for connection"

  - action: "servercommand"
    command: "say [Pilaf] Starting entity filtering test..."
    name: "Announce test start"

  - action: "servercommand"
    command: "gamemode creative pilaf_filter"
    name: "Set creative mode"

steps:
  # Test 1: Get initial entities
  - action: "getentities"
    player: "pilaf_filter"
    name: "Get initial entities"
    storeAs: "entities_initial"

  # Test 2: Spawn entity types
  - action: "servercommand"
    command: "summon zombie 10 65 10"
    name: "Spawn zombie"

  - action: "wait"
    duration: 1
    name: "Wait"

  - action: "servercommand"
    command: "summon cow 15 65 15"
    name: "Spawn cow"

  - action: "wait"
    duration: 2
    name: "Wait for all spawns"

  # Test 3: Get entities after spawning
  - action: "getentities"
    player: "pilaf_filter"
    name: "Get entities after spawning"
    storeAs: "entities_after_spawn"

  # Test 4: Compare entity counts
  - action: "compare_states"
    state1: "entities_initial"
    state2: "entities_after_spawn"
    name: "Compare entity counts"
    storeAs: "entity_comparison"

  - action: "print_state_comparison"
    variableName: "entity_comparison"
    name: "Print entity comparison"

cleanup:
  - action: "servercommand"
    command: "kill @e[type=zombie,x=10,y=65,z=10,distance=..30]"
    name: "Remove zombies"

  - action: "servercommand"
    command: "kill @e[type=cow,x=15,y=65,z=15,distance=..30]"
    name: "Remove cows"

  - action: "servercommand"
    command: "say [Pilaf] Entity filtering test completed"
    name: "Announce completion"

  - action: "disconnect"
    player: "pilaf_filter"
    name: "Disconnect test player"
