# Test: JSONPath Extraction
# Category: State Management
# Purpose: Tests JSONPath data extraction from stored states

name: "JSONPath Extraction Test"
description: |
  Tests JSONPath extraction from stored states.
  Demonstrates extracting specific data from complex state objects.

backend: mineflayer

setup:
  - action: "connect"
    player: "pilaf_jsonpath"
    name: "Connect JSONPath test player"

  - action: "wait"
    duration: 5
    name: "Wait for connection"

  - action: "servercommand"
    command: "say [Pilaf] Starting JSONPath extraction test..."
    name: "Announce test start"

steps:
  # Test 1: Store player position
  - action: "get_player_position"
    player: "pilaf_jsonpath"
    name: "Get player position"
    storeAs: "position_data"

  - action: "print_stored_state"
    variableName: "position_data"
    name: "Print position data"

  # Test 2: Store player health
  - action: "get_player_health"
    player: "pilaf_jsonpath"
    name: "Get player health"
    storeAs: "health_data"

  - action: "print_stored_state"
    variableName: "health_data"
    name: "Print health data"

  # Test 3: Store weather status
  - action: "get_weather"
    name: "Get weather status"
    storeAs: "weather_data"

  - action: "print_stored_state"
    variableName: "weather_data"
    name: "Print weather data"

  # Test 4: Compare states
  - action: "servercommand"
    command: "tp pilaf_jsonpath 300 70 300"
    name: "Teleport player"

  - action: "wait"
    duration: 3
    name: "Wait for teleport"

  - action: "get_player_position"
    player: "pilaf_jsonpath"
    name: "Get new position"
    storeAs: "position_data_new"

  - action: "compare_states"
    state1: "position_data"
    state2: "position_data_new"
    name: "Compare position states"
    storeAs: "position_diff"

  - action: "print_state_comparison"
    variableName: "position_diff"
    name: "Print position difference"

cleanup:
  - action: "servercommand"
    command: "tp pilaf_jsonpath 0 64 0"
    name: "Return player to spawn"

  - action: "servercommand"
    command: "say [Pilaf] JSONPath extraction test completed"
    name: "Announce completion"

  - action: "disconnect"
    player: "pilaf_jsonpath"
    name: "Disconnect test player"
