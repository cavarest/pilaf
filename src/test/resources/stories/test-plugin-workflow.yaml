# Test: Complete Plugin Testing Workflow
# Category: Combined Workflows
# Purpose: Demonstrates a complete plugin testing workflow

name: "Plugin Testing Workflow"
description: |
  A comprehensive plugin testing workflow that demonstrates
  setting up test environment, executing plugin commands,
  verifying results, and cleanup.

backend: mineflayer

setup:
  - action: "connect"
    player: "pilaf_plugin_test"
    name: "Connect plugin test player"

  - action: "wait"
    duration: 5
    name: "Wait for connection"

  - action: "servercommand"
    command: "say [Pilaf] Starting plugin testing workflow..."
    name: "Announce test start"

  - action: "servercommand"
    command: "gamemode creative pilaf_plugin_test"
    name: "Set creative mode"

  - action: "servercommand"
    command: "clear pilaf_plugin_test"
    name: "Clear inventory"

  - action: "servercommand"
    command: "tp pilaf_plugin_test 0 64 0"
    name: "Teleport to spawn"

steps:
  # Phase 1: Environment Setup
  - action: "servercommand"
    command: "say [Pilaf] Phase 1: Environment Setup"
    name: "Announce phase 1"

  - action: "get_player_position"
    player: "pilaf_plugin_test"
    name: "Get spawn position"
    storeAs: "spawn_position"

  - action: "get_player_health"
    player: "pilaf_plugin_test"
    name: "Get initial health"
    storeAs: "initial_health"

  - action: "getinventory"
    player: "pilaf_plugin_test"
    name: "Get initial inventory"
    storeAs: "initial_inventory"

  # Phase 2: Item Management Test
  - action: "servercommand"
    command: "say [Pilaf] Phase 2: Item Management"
    name: "Announce phase 2"

  - action: "giveitem"
    player: "pilaf_plugin_test"
    item: "diamond_pickaxe"
    count: 1
    name: "Give diamond pickaxe"

  - action: "giveitem"
    player: "pilaf_plugin_test"
    item: "torch"
    count: 32
    name: "Give torches"

  - action: "giveitem"
    player: "pilaf_plugin_test"
    item: "bread"
    count: 10
    name: "Give bread"

  - action: "getinventory"
    player: "pilaf_plugin_test"
    name: "Get inventory after items"
    storeAs: "inventory_after_items"

  - action: "compare_states"
    state1: "initial_inventory"
    state2: "inventory_after_items"
    name: "Compare inventory changes"
    storeAs: "item_change"

  - action: "print_state_comparison"
    variableName: "item_change"
    name: "Print item changes"

  # Phase 3: Movement and Positioning
  - action: "servercommand"
    command: "say [Pilaf] Phase 3: Movement and Positioning"
    name: "Announce phase 3"

  - action: "servercommand"
    command: "tp pilaf_plugin_test 100 64 100"
    name: "Teleport to test location"

  - action: "wait"
    duration: 3
    name: "Wait for teleport"

  - action: "get_player_position"
    player: "pilaf_plugin_test"
    name: "Get new position"
    storeAs: "new_position"

  - action: "compare_states"
    state1: "spawn_position"
    state2: "new_position"
    name: "Compare positions"
    storeAs: "position_change"

  - action: "print_state_comparison"
    variableName: "position_change"
    name: "Print position change"

  # Phase 4: Entity Spawning
  - action: "servercommand"
    command: "say [Pilaf] Phase 4: Entity Spawning"
    name: "Announce phase 4"

  - action: "getentities"
    player: "pilaf_plugin_test"
    name: "Get initial entities"
    storeAs: "entities_before"

  - action: "servercommand"
    command: "summon cow 105 65 105"
    name: "Spawn cow"

  - action: "servercommand"
    command: "summon sheep 110 65 110"
    name: "Spawn sheep"

  - action: "wait"
    duration: 2
    name: "Wait for spawns"

  - action: "getentities"
    player: "pilaf_plugin_test"
    name: "Get entities after spawning"
    storeAs: "entities_after"

  - action: "compare_states"
    state1: "entities_before"
    state2: "entities_after"
    name: "Compare entity changes"
    storeAs: "entity_change"

  - action: "print_state_comparison"
    variableName: "entity_change"
    name: "Print entity changes"

  # Phase 5: Environment Test
  - action: "servercommand"
    command: "say [Pilaf] Phase 5: Environment Control"
    name: "Announce phase 5"

  - action: "get_weather"
    name: "Get initial weather"
    storeAs: "weather_initial"

  - action: "servercommand"
    command: "weather rain 300"
    name: "Set rain weather"

  - action: "wait"
    duration: 2
    name: "Wait for weather change"

  - action: "get_weather"
    name: "Get weather during rain"
    storeAs: "weather_rain"

  - action: "servercommand"
    command: "weather clear 600"
    name: "Restore clear weather"

  - action: "get_world_time"
    name: "Get world time"
    storeAs: "world_time"

cleanup:
  - action: "servercommand"
    command: "say [Pilaf] Cleanup Phase"
    name: "Announce cleanup"

  - action: "servercommand"
    command: "kill @e[type=cow,x=105,y=65,z=105,distance=..20]"
    name: "Remove spawned cow"

  - action: "servercommand"
    command: "kill @e[type=sheep,x=110,y=65,z=110,distance=..20]"
    name: "Remove spawned sheep"

  - action: "servercommand"
    command: "clear pilaf_plugin_test"
    name: "Clear player inventory"

  - action: "servercommand"
    command: "tp pilaf_plugin_test 0 64 0"
    name: "Return player to spawn"

  - action: "servercommand"
    command: "say [Pilaf] Plugin testing workflow completed"
    name: "Announce completion"

  - action: "disconnect"
    player: "pilaf_plugin_test"
    name: "Disconnect test player"
